(function(){var t={4129:function(t){const e=960;async function n(t,e){let n=document.createElement("video");n.setAttribute("autoplay",""),n.setAttribute("muted",""),n.setAttribute("playsinline",""),n.setAttribute("ref","video"),n.style.position="absolute",n.style.top="0px",n.style.left="0px",n.style.zIndex="-2",navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:t}}).then((t=>(n.addEventListener("loadedmetadata",(()=>{n.setAttribute("width",n.videoWidth+"px"),n.setAttribute("height",n.videoHeight+"px"),window.addEventListener("resize",r(n))})),n.srcObject=t,e(n),r(),n))).catch((t=>{throw t}))}function i(t){let n=document.createElement("canvas");n.style.display="none",n.width=e,n.height=t.videoHeight/t.videoWidth*n.width,n.getContext("2d").drawImage(t,0,0,n.width,n.height);let i=n.toDataURL("image/jpeg");return i}function r(t){let e,n,i=t?.parentElement;if(!t||!i)return;const r=t.videoWidth/t.videoHeight,o=i.clientWidth/i.clientHeight;r>o?(n=i.clientHeight,e=n*r):(e=i.clientWidth,n=e/r),t.style.top=-(n-i.clientHeight)/2+"px",t.style.left=-(e-i.clientWidth)/2+"px",t.style.width=e+"px",t.style.height=n+"px"}t.exports={CreateCameraVideo:n,TakePhoto:i}},3861:function(t){const e="#scanningOverlay",n="#loadingOverlay",i=5,r=5,o=.001,s=1e3;function a(t,a){return new window.MINDAR.IMAGE.MindARThree({container:a,imageTargetSrc:t,uiScanning:e,uiLoading:n,warmupTolerance:i,missTolerance:r,filterMinCF:o,filterBeta:s})}function c(t){return new window.MINDAR.FACE.MindARThree({container:t,uiScanning:e,uiLoading:n})}t.exports={MindArTarget:a,MindArFace:c}},7939:function(t,e,n){"use strict";var i=n(9242),r=n(3396);const o={id:"app"};function s(t,e){const n=(0,r.up)("router-view");return(0,r.wg)(),(0,r.iD)("div",o,[(0,r.Wm)(n)])}var a=n(89);const c={},h=(0,a.Z)(c,[["render",s]]);var d=h,l=n(2483);const u={id:"app"},f={id:"container"},m={id:"unity-canvas",ref:"uc"},g={id:"videoContainer",ref:"vc"},w={key:0,id:"loaderMain"},p=(0,r._)("div",{id:"loadingIndicator"},[(0,r._)("div",{class:"loader"})],-1),v=[p],y={key:1,id:"scanningMain"},b=(0,r._)("div",{id:"loadingIndicator"},[(0,r._)("div",{class:"loader"})],-1),S=[b];function A(t,e,n,o,s,a){return(0,r.wg)(),(0,r.iD)("div",u,[(0,r.wy)((0,r._)("div",f,[(0,r._)("canvas",m,null,512),(0,r._)("div",g,null,512)],512),[[i.F8,!0]]),s.ShowLoading?((0,r.wg)(),(0,r.iD)("div",w,v)):(0,r.kq)("",!0),s.ShowScanning?((0,r.wg)(),(0,r.iD)("div",y,S)):(0,r.kq)("",!0)])}class M{constructor(t=0,e=0,n=0){this.x=t,this.y=e,this.z=n}set(t,e,n){return this.x=t,this.y=e,this.z=n,this}magnitude(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}toJson(){return`{ "x": ${this.x}, "y": ${this.y}, "z": ${this.z} }`}}class C{constructor(t=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){this.elements=t}clone(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],this}decompose(t,e,n){const i=this.elements;let r=new M(i[0],i[1],i[2]).magnitude();const o=new M(i[4],i[5],i[6]).magnitude(),s=new M(i[8],i[9],i[10]).magnitude(),a=this.determinant();a<0&&(r=-r);const c=1/r,h=1/o,d=1/s,l=new C;return l.clone(this),l.elements[0]*=c,l.elements[1]*=c,l.elements[2]*=c,l.elements[4]*=h,l.elements[5]*=h,l.elements[6]*=h,l.elements[8]*=d,l.elements[9]*=d,l.elements[10]*=d,t.set(i[12],i[14],i[13]),n.set(r,o,s),e.setFromRotationMatrix(l),this}determinant(){const t=this.elements,e=t[0],n=t[4],i=t[8],r=t[12],o=t[1],s=t[5],a=t[9],c=t[13],h=t[2],d=t[6],l=t[10],u=t[14],f=t[3],m=t[7],g=t[11],w=t[15];return f*(+r*a*d-i*c*d-r*s*l+n*c*l+i*s*u-n*a*u)+m*(+e*a*u-e*c*l+r*o*l-i*o*u+i*c*h-r*a*h)+g*(+e*c*d-e*s*u-r*o*d+n*o*u+r*s*h-n*c*h)+w*(-i*s*h-e*a*d+e*s*l+i*o*d-n*o*l+n*a*h)}}class x{constructor(t=0,e=0,n=0,i=1){this.x=t,this.y=e,this.z=n,this.w=i}setFromRotationMatrix(t){const e=t.elements,n=e[0],i=e[4],r=e[8],o=e[1],s=e[5],a=e[9],c=e[2],h=e[6],d=e[10],l=n+s+d;if(l>0){const t=.5/Math.sqrt(l+1);this.x=(h-a)*t,this.y=(o-i)*t,this.z=(r-c)*t,this.w=.25/t}else if(n>s&&n>d){const t=2*Math.sqrt(1+n-s-d);this.x=.25*t,this.y=(r+c)/t,this.z=(i+o)/t,this.w=(h-a)/t}else if(s>d){const t=2*Math.sqrt(1+s-n-d);this.x=(i+o)/t,this.y=(a+h)/t,this.z=.25*t,this.w=(r-c)/t}else{const t=2*Math.sqrt(1+d-n-s);this.x=(r+c)/t,this.y=.25*t,this.z=(a+h)/t,this.w=(o-i)/t}return this.x*=-1,this}toJson(){return`{ "x": ${this.x}, "y": ${this.y}, "z": ${this.z}, "w":${this.w} }`}}class I{constructor(){}toJson(){}isValid(){}}class O extends I{constructor(t,e,n,i=60,r=[]){super(),t||(t=new M),e||(t=new x),n||(t=new M),this.position=t,this.rotation=e,this.scale=n,this.camerFOV=i,this.faceMeshData=r}toJson(){const t=this.position.toJson(),e=this.rotation.toJson(),n=this.scale.toJson();let i=this.faceMeshData.join();return`{\n\t\t\t\t\t"position": ${t}, \n\t\t\t\t\t"rotation": ${e}, \n\t\t\t\t\t"scale": ${n}, \n\t\t\t\t\t"camerFOV": ${this.camerFOV}, \n\t\t\t\t\t"facemesh": "${i}"\n\t\t\t\t}`}isValid(){return!!(this.position&&this.rotation&&this.scale&&this.camerFOV&&this.faceMeshData)}}class T extends I{constructor(t,e,n,i=60){super(),t||(t=new M),e||(t=new x),n||(t=new M),this.position=t,this.rotation=e,this.scale=n,this.camerFOV=i}toJson(){const t=this.position.toJson(),e=this.rotation.toJson(),n=this.scale.toJson();return`{\n\t\t\t\t\t"position": ${t}, \n\t\t\t\t\t"rotation": ${e}, \n\t\t\t\t\t"scale": ${n}, \n\t\t\t\t\t"camerFOV": ${this.camerFOV} \n\t\t\t\t}`}isValid(){return!!(this.position&&this.rotation&&this.scale&&this.camerFOV)}}function E(t,e){e.SendMessage(t,"StartTracking")}function L(t,e,n,i,r,o,s){V(t,e,n,i,r,o,s)}function k(t,e){e.SendMessage(t,"StopTracking")}function V(t,e,n,i,r,o,s){let a=new O(n,i,r,o,s);if(!a.isValid())throw"Face transform is invalid!";e&&e.SendMessage(t,"Tracking",a.toJson())}function _(t,e){e.SendMessage(t,"StartTracking")}function R(t,e,n,i,r,o){j(t,e,n,i,r,o)}function F(t,e){e.SendMessage(t,"StopTracking")}function j(t,e,n,i,r,o){let s=new T(n,i,r,o);if(!s.isValid())throw console.error(s),"Target transform is invalid!";e&&e.SendMessage(t,"Tracking",s.toJson())}function z(t,e,n){e.SendMessage(t,"SceneLoadedEvent",n)}let N;function D(t,e){var n="./Build",i=n+"/UnitedAppTest.loader.js",r={dataUrl:n+"/UnitedAppTest.data",frameworkUrl:n+"/UnitedAppTest.framework.js",codeUrl:n+"/UnitedAppTest.wasm",streamingAssetsUrl:"StreamingAssets",companyName:"PustovietovQS",productName:"ar-unity-renderer-test-0.3.3",productVersion:"0.1"};t.width=window.innerWidth,t.height=window.innerHeight;var o=document.createElement("script");o.src=i,o.onload=()=>{createUnityInstance(t,r).then((t=>{N=t,e(t)})).catch((t=>{}))},t.appendChild(o)}function $(t){_(t,N)}function P(t,e,n){B(e,((e,i,r)=>{R(t,N,e,i,r,n)}))}function J(t){F(t,N)}function U(t){E(t,N)}function W(t,e,n,i){B(e,((e,r,o)=>{L(t,N,e,r,o,n,i)}))}function q(t){k(t,N)}function H(t,e){z(t,N,e)}function B(t,e){const n=new C(t),i=new M,r=new M,o=new x;return n.decompose(i,o,r),e(i,o,r)}class G{constructor(t,e){this.controller=e,this.sceneIndex=t,this.isTargetVisible=!1,this.start=null,this.stop=null}}var Z=n(3861);class K extends G{constructor(t,e){super(t,e)}async Initialize(){}async CreateMindAr(t){return this.mindARContainer=t,await n.e(816).then(n.t.bind(n,9816,23)).then((async()=>{let e=(0,Z.MindArFace)(t),n=e.addFaceMesh();e.addAnchor(0);let i=e.renderer,r=e.scene,o=e.camera;this.start=async()=>{await e.start(),i.setAnimationLoop((()=>{i.render(r,o),this.CheckTarget(e,n.geometry.positions)})),H(this.controller,Number(this.sceneIndex))},this.stop=async()=>{await e.stop(),i.setAnimationLoop(null)}}))}CheckTarget(t,e){let n=t.container.offsetWidth/t.container.offsetHeight,i=n<4/3?t.camera.fov:t.camera.fov*(4/3)/n,r=t.anchors[0];if(r.group.visible){let t=r.group.matrix.elements;this.isTargetVisible||(this.isTargetVisible=!0,U(this.controller)),W(this.controller,t,i,e)}else this.isTargetVisible&&(this.isTargetVisible=!1,q(this.controller))}}n(7658),n(4200);const Y=new window.MINDAR.IMAGE.Compiler;async function Q(t){const e=[];for(let r=0;r<t.length;r++){let n=await X(t[r]);e.push(n)}await Y.compileImageTargets(e,(t=>{console.log(t)}));const n=await Y.exportData();let i=tt(n);return i}async function X(t){return new Promise(((e,n)=>{let i=new Image;i.onload=()=>e(i),i.onerror=n,i.src=t}))}function tt(t){var e=new Blob([t]),n=window.document.createElement("a");return n.download="targets.mind",n.href=window.URL.createObjectURL(e),n.href}class et extends G{constructor(t,e){super(t,e),this.targets=null}async Initialize(t){this.targets=await Q([t])}async CreateMindAr(t){return this.mindARContainer=t,await n.e(528).then(n.t.bind(n,5528,23)).then((async()=>{let e=(0,Z.MindArTarget)(this.targets,t);e.addAnchor(0);let n=e.renderer,i=e.scene,r=e.camera;this.start=async()=>{await e.start(),n.setAnimationLoop((()=>{n.render(i,r),this.CheckTarget(e)})),H(this.controller,Number(this.sceneIndex))},this.stop=async()=>{await e.stop(),n.setAnimationLoop(null)}}))}CheckTarget(t){let e=t.container.offsetWidth/t.container.offsetHeight,n=e<4/3?t.camera.fov:t.camera.fov*(4/3)/e,i=t.anchors[0];if(i.group.visible){let t=i.group.matrix.elements;this.isTargetVisible||(this.isTargetVisible=!0,$(this.controller)),P(this.controller,t,n)}else this.isTargetVisible&&(this.isTargetVisible=!1,J(this.controller))}}var nt=n(4129);class it{constructor(t,e,n){this.unityContainer=t,this.videoContainer=e,this.mindARContainerId=n.mindARContainerId,this.showLoadingIndicator=n.ShowLoadingIndicator,this.showScanningIndicator=n.ShowScanningIndicator,this.cameraVideo=null,this.currentScene=null,this.allScenes=[],window.SCENE_LOADER=this}async LoadScene(t,e,n,i){var r,o;if(this.showLoadingIndicator(!0),e=Number(e),this.allScenes[e])return this.SwitchScene(this.allScenes[e]);switch(t){case"face":this.videoContainer.style.transform="scale(-1, 1)",r=this.CreateMindArContainer(),r.style.transform="scale(-1, 1)",o=new K(e,n),await o.Initialize();break;case"image":r=this.CreateMindArContainer(),r.style.transform="scale(1, 1)";var s=`./Targets/${i}.png`;o=new et(e,n),await o.Initialize(s);break;case"surface":return await(0,nt.CreateCameraVideo)("environment",(t=>{this.cameraVideo=t,this.video=this.cameraVideo,this.videoContainer.appendChild(this.cameraVideo)})),void this.showLoadingIndicator(!1);default:throw new Error(`${o} is not correct scene type!`)}await o.CreateMindAr(r),this.allScenes[o.sceneIndex]=o,this.SwitchScene(o)}async ScanSurface(t,e){if(t=Number(t),null!==this.cameraVideo){let i=this.CreateMindArContainer();i.style.transform="scale(1, 1)",this.showScanningIndicator(!0);var n=(0,nt.TakePhoto)(this.video);let r=new et(t,e);await r.Initialize(n),await r.CreateMindAr(i),this.showScanningIndicator(!1),this.allScenes[r.sceneIndex]=r,this.SwitchScene(r)}}async SwitchScene(t){null!==this.currentScene&&(await this.currentScene.stop(),this.currentScene.mindARContainer.remove());let e=t.mindARContainer;this.unityContainer.parentElement.appendChild(e),this.currentScene=t,await this.currentScene.start(),this.showLoadingIndicator(!1)}CreateMindArContainer(){let t=document.createElement("div");return t.setAttribute("id",this.mindARContainerId),t}}var rt={name:"App",data(){return{sceneLoader:null,ShowLoading:!1,ShowScanning:!1,mindARContainerId:"mindArContainer"}},created(){addEventListener("beforeunload",(()=>{fetch("/quit").catch((t=>{throw t}))}))},mounted(){this.Initialization()},methods:{async Initialization(){let t=this.$refs.uc,e=this.$refs.vc;this.sceneLoader=new it(t,e,this),D(t,(()=>{}))},ShowLoadingIndicator(t){this.ShowLoading=t},ShowScanningIndicator(t){this.ShowScanning=t}}};const ot=(0,a.Z)(rt,[["render",A]]);var st=ot;const at=l.p7({history:l.r5(),routes:[{path:"/:id?",component:st}]});(0,i.ri)(d).use(at).mount("#app")}},e={};function n(i){var r=e[i];if(void 0!==r)return r.exports;var o=e[i]={exports:{}};return t[i](o,o.exports,n),o.exports}n.m=t,function(){var t=[];n.O=function(e,i,r,o){if(!i){var s=1/0;for(d=0;d<t.length;d++){i=t[d][0],r=t[d][1],o=t[d][2];for(var a=!0,c=0;c<i.length;c++)(!1&o||s>=o)&&Object.keys(n.O).every((function(t){return n.O[t](i[c])}))?i.splice(c--,1):(a=!1,o<s&&(s=o));if(a){t.splice(d--,1);var h=r();void 0!==h&&(e=h)}}return e}o=o||0;for(var d=t.length;d>0&&t[d-1][2]>o;d--)t[d]=t[d-1];t[d]=[i,r,o]}}(),function(){n.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return n.d(e,{a:e}),e}}(),function(){var t,e=Object.getPrototypeOf?function(t){return Object.getPrototypeOf(t)}:function(t){return t.__proto__};n.t=function(i,r){if(1&r&&(i=this(i)),8&r)return i;if("object"===typeof i&&i){if(4&r&&i.__esModule)return i;if(16&r&&"function"===typeof i.then)return i}var o=Object.create(null);n.r(o);var s={};t=t||[null,e({}),e([]),e(e)];for(var a=2&r&&i;"object"==typeof a&&!~t.indexOf(a);a=e(a))Object.getOwnPropertyNames(a).forEach((function(t){s[t]=function(){return i[t]}}));return s["default"]=function(){return i},n.d(o,s),o}}(),function(){n.d=function(t,e){for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})}}(),function(){n.f={},n.e=function(t){return Promise.all(Object.keys(n.f).reduce((function(e,i){return n.f[i](t,e),e}),[]))}}(),function(){n.u=function(t){return"js/"+t+"."+{528:"3d0cf46c",816:"568763d8"}[t]+".js"}}(),function(){n.miniCssF=function(t){}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){var t={},e="ar-unity-renderer:";n.l=function(i,r,o,s){if(t[i])t[i].push(r);else{var a,c;if(void 0!==o)for(var h=document.getElementsByTagName("script"),d=0;d<h.length;d++){var l=h[d];if(l.getAttribute("src")==i||l.getAttribute("data-webpack")==e+o){a=l;break}}a||(c=!0,a=document.createElement("script"),a.charset="utf-8",a.timeout=120,n.nc&&a.setAttribute("nonce",n.nc),a.setAttribute("data-webpack",e+o),a.src=i),t[i]=[r];var u=function(e,n){a.onerror=a.onload=null,clearTimeout(f);var r=t[i];if(delete t[i],a.parentNode&&a.parentNode.removeChild(a),r&&r.forEach((function(t){return t(n)})),e)return e(n)},f=setTimeout(u.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=u.bind(null,a.onerror),a.onload=u.bind(null,a.onload),c&&document.head.appendChild(a)}}}(),function(){n.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){n.p=""}(),function(){var t={143:0};n.f.j=function(e,i){var r=n.o(t,e)?t[e]:void 0;if(0!==r)if(r)i.push(r[2]);else{var o=new Promise((function(n,i){r=t[e]=[n,i]}));i.push(r[2]=o);var s=n.p+n.u(e),a=new Error,c=function(i){if(n.o(t,e)&&(r=t[e],0!==r&&(t[e]=void 0),r)){var o=i&&("load"===i.type?"missing":i.type),s=i&&i.target&&i.target.src;a.message="Loading chunk "+e+" failed.\n("+o+": "+s+")",a.name="ChunkLoadError",a.type=o,a.request=s,r[1](a)}};n.l(s,c,"chunk-"+e,e)}},n.O.j=function(e){return 0===t[e]};var e=function(e,i){var r,o,s=i[0],a=i[1],c=i[2],h=0;if(s.some((function(e){return 0!==t[e]}))){for(r in a)n.o(a,r)&&(n.m[r]=a[r]);if(c)var d=c(n)}for(e&&e(i);h<s.length;h++)o=s[h],n.o(t,o)&&t[o]&&t[o][0](),t[o]=0;return n.O(d)},i=self["webpackChunkar_unity_renderer"]=self["webpackChunkar_unity_renderer"]||[];i.forEach(e.bind(null,0)),i.push=e.bind(null,i.push.bind(i))}();var i=n.O(void 0,[998],(function(){return n(7939)}));i=n.O(i)})();
//# sourceMappingURL=app.13607199.js.map
